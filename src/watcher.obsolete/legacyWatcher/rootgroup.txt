ROOT GROUP SUPPORT
==================

Updated: 7 August 2007, Darrell Kindred

A brief introduction to the new "root group" support.

1. Who is in the root group?

   Currently (as of 8/7/07), it is all ELIGIBLE nodes who are no more than
   interim_rootgroupradius (in live.conf) hops from their root node.

   If different nodes have different values of interim_rootgroupradius,
   it is the root's value that determines the root group radius.

   To make a node eligible for root group membership:
         a. Create a positionweight file (e.g., "live.posweight") 
            in the same directory as your live.conf.
         b. Add the following to live.conf:
		positionweightfile:live.posweight
         c. For each eligible node, add a line to live.posweight like this:
		1.2.3.4 ROOTGROUP assigned

   Upcoming refinements will set the radius dynamically to include 
   approximately the desired number of root group members.


2. How can a client determine whether its node is in the root group?

      Register your callback:

        idsPositionRegister(cs, COORDINATOR_ROOTGROUP,IDSPOSITION_INFORM,
                            myPositionCallback,NULL);

      Then you'll get called with position==COORDINATOR_ROOTGROUP and
      position==IDSPOSITION_ACTIVE or IDSPOSITION_INACTIVE.

        static int in_rootgroup = 0;

        void myPositionCallback(void *data, IDSPositionType position, 
                                IDSPositionStatus status)
        {
          switch(status)
          {
            case IDSPOSITION_ACTIVE:
                printf("position %s, active\n",idsPosition2Str(position));
                if (position==COORDINATOR_ROOTGROUP) in_rootgroup = 1;
                break;
            case IDSPOSITION_INACTIVE:
                printf("position %s, INactive\n",idsPosition2Str(position));
                if (position==COORDINATOR_ROOTGROUP) in_rootgroup = 0;
                break;
            default:
                printf("invalid position status!\n");
          }
       }

       See testapi.c and demolib.c, which use code nearly identical 
       to that above.


3. How do I send a message to the root group?

   Just generate a message with the following destination:
        CommunicationsDestination dst = {
                NODE_ROOTGROUP,
                COMMUNICATIONSDESTINATION_MULTICAST,
                MESSAGE_MAXTTL
        };

   Note that currently (as of 7/15/07), this is just a flooding
   broadcast to the entire network, so the daemon on every node
   will receive it, but it will only reach applications on the
   root group members.  We will soon apply optimizations to make
   the distribution more efficient.
